create or replace PROCEDURE RELLENAR_TABLA_GRUPOS2
IS
    CURSOR EMPLEADOS_DEPT IS SELECT D.DNOMBRE, D.LOC, D.DEPT_NO, E.APELLIDO, E.EMP_NO FROM DEPARTAMENTOS D LEFT JOIN EMPLEADOS E ON  D.DEPT_NO = E.DEPT_NO ORDER BY D.DEPT_NO;
    
    DNOMBRE_ACTUAL VARCHAR2(30);
    LISTA_EMPLEADOS PERSONA3_EMPLEADOS := PERSONA3_EMPLEADOS();
    
    CONTADOR NUMBER;
    DEPT_NO_ACTUAL NUMBER;
    DEPT_NO_OLD NUMBER;
BEGIN
    DELETE FROM GRUPOS;
    
    CONTADOR := 1;

    FOR I IN EMPLEADOS_DEPT LOOP
    
DNOMBRE_ACTUAL := I.DNOMBRE;

        DEPT_NO_ACTUAL := I.DEPT_NO;
        
        IF (DEPT_NO_OLD = DEPT_NO_ACTUAL AND CONTADOR < 5) OR (DEPT_NO_OLD IS NULL) THEN      
            CONTADOR := CONTADOR + 1;
        ELSE
            INSERT INTO GRUPOS VALUES(DNOMBRE_ACTUAL, LISTA_EMPLEADOS);
            LISTA_EMPLEADOS.DELETE;
            CONTADOR := 1;
        END IF;

        LISTA_EMPLEADOS.EXTEND;
        LISTA_EMPLEADOS(CONTADOR) := PERSONA3(I.EMP_NO, I.APELLIDO, I.LOC); 
DEPT_NO_OLD := DEPT_NO_ACTUAL;

    END LOOP;

    COMMIT;
END;


DECLARE
BEGIN
    RELLENAR_TABLA_GRUPOS2();
END;